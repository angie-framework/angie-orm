<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/models/AngieDatabaseRouter.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/benderTheCrime/angie-orm.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/util/$ExceptionsProvider.js~$$InvalidConfigError.html">$$InvalidConfigError</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/$Fields.js~BaseField.html">BaseField</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/BaseModel.js~BaseModel.html">BaseModel</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/FirebaseConnection.js~FirebaseConnection.html">FirebaseConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/MongoDBConnection.js~MongoDBConnection.html">MongoDBConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/MySqlConnection.js~MySqlConnection.html">MySqlConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/SqliteConnection.js~SqliteConnection.html">SqliteConnection</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-AngieDatabaseRouter">AngieDatabaseRouter</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-Base">Base</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-runTests">runTests</a></span></li>
</ul>
</div>






</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/models/AngieDatabaseRouter.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">/**
 * @module AngieDatabaseRouter.js
 * @author Joe Groseclose &lt;@benderTheCrime&gt;
 * @date 8/23/2015
 */

// System Modules
import fs from                          &apos;fs&apos;;

// Angie ORM Modules
import SqliteConnection from            &apos;./SqliteConnection&apos;;
import MySqlConnection from             &apos;./MySqlConnection&apos;;
import FirebaseConnection from          &apos;./FirebaseConnection&apos;;
import MongoDBConnection from           &apos;./MongoDBConnection&apos;;
import {
    $$InvalidConfigError,
    $$InvalidDatabaseConfigError
} from                                  &apos;../util/$ExceptionsProvider&apos;;

const p = process;
let app,
    dbs = {},
    config;

function AngieDatabaseRouter(args) {
    app = app || global.app;

    let database,
        name = &apos;default&apos;;

    if (!config &amp;&amp; !global.app.$$config) {
        try {
            const $$config = JSON.parse(
                fs.readFileSync(`${process.cwd()}/AngieORMFile.json`)
            );

            if (typeof $$config === &apos;object&apos;) {
                global.app.$$config = $$config;
                Object.freeze(app.$$config);
            } else {
                throw new Error();
            }
        } catch(e) {
            throw new $$InvalidConfigError();
        }
    }
    config = global.app.$$config;




    if (args instanceof Array) {
        for (let arg of args) {
            if (Object.keys(config.databases).indexOf(arg) &gt; -1) {
                name = arg;
                break;
            }
        }
    } else if (typeof args === &apos;string&apos;) {
        name = args;
    }

    // Check to see if the database is in memory
    database = dbs[ name ];
    if (database) {
        return database;
    }

    // Try to fetch database by name or try to grab default
    let db = config.databases &amp;&amp; config.databases[ name ] ?
            config.databases[ name ] : config.databases.default ?
                config.databases.default : null,
        destructive = p.argv.some((v) =&gt; /--destructive/i.test(v)),
        dryRun = p.argv.some((v) =&gt; /--dry([-_])?run/i.test(v));

    if (db &amp;&amp; db.type) {
        switch (db.type.toLowerCase()) {
            case &apos;mysql&apos;:
                database = new MySqlConnection(name, db, destructive, dryRun);
                break;
            case &apos;mongodb&apos;:
                database = new MongoDBConnection(db, destructive, dryRun);
                break;
            case &apos;firebase&apos;:
                database = new FirebaseConnection(db, destructive, dryRun);
                break;
            default:
                database = new SqliteConnection(db, destructive, dryRun);
        }
    }

    if (!database) {
        throw new $$InvalidDatabaseConfigError();
    }

    // Setup a cache of database connections in memory already
    dbs[ name ] = database;
    return database;
}

export default AngieDatabaseRouter;
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
