<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/models/$Fields.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/benderTheCrime/angie-orm.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/util/$ExceptionsProvider.js~$$InvalidConfigError.html">$$InvalidConfigError</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/$Fields.js~BaseField.html">BaseField</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/BaseModel.js~BaseModel.html">BaseModel</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/databases/FirebaseConnection.js~FirebaseConnection.html">FirebaseConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/databases/MongoDBConnection.js~MongoDBConnection.html">MongoDBConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/databases/MySqlConnection.js~MySqlConnection.html">MySqlConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/databases/SqliteConnection.js~SqliteConnection.html">SqliteConnection</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-AngieDatabaseRouter">AngieDatabaseRouter</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-Base">Base</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-runTests">runTests</a></span></li>
</ul>
</div>






</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/models/$Fields.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">/**
 * @module $Fields.js
 * @author Joe Groseclose &lt;@benderTheCrime&gt;
 * @date 8/23/2015
 */

// System Modules
import util from                &apos;util&apos;;
import {magenta, cyan} from     &apos;chalk&apos;;
import $LogProvider from        &apos;angie-log&apos;;

const p = process;

class BaseField {
    constructor(
        args = 0,
        maxValue = undefined,
        minLength = 0,
        maxLength = undefined,
        nullable = false,
        unique = false,
        $default = undefined
    ) {
        this.type = &apos;BaseField&apos;;
        if (typeof args === &apos;object&apos;) {
            util._extend(this, arguments[0]);
        } else if (!isNaN(args)) {
            if (args === 1) {
                return;
            }
            [
                this.minValue,
                this.maxValue,
                this.minLength,
                this.maxLength,
                this.nullable,
                this.unique,
                this.default
            ] = [
                args,
                maxValue,
                minLength,
                maxLength,
                nullable,
                unique,
                $default
            ];
        }
    }
    create() {

        // TODO this method is not responsible for migrating a model, only
        // creating a field in a record when the model is instantiated
        if (this.default) {
            if (this.validate(this.default)) {
                this.value = typeof this.default === &apos;function&apos; ? this.default() :
                    this.default;
            } else {
                throw new $$InvalidFieldConfigError(
                    this.type,
                    &apos;Invalid default value&apos;
                );
            }
        }
    }
    validate(value) {

        // TODO is this necessary?
        // value = value || this.value;
        if (!value &amp;&amp; !this.nullable) {
            return false;
        }
        if (
            typeof value === &apos;string&apos; &amp;&amp;
            (
                (
                    this.minLength &amp;&amp;
                    value.length &lt; this.minLength
                ) ||
                (
                    this.maxLength &amp;&amp;
                    value.length &gt; this.maxLength
                )
            )
        ) {
            return false;
        } else if (
            (
                this.minValue &amp;&amp;
                value &lt; this.minValue
            ) ||
            (
                this.maxValue &amp;&amp;
                value &gt; this.maxValue
            )
        ) {
            return false;
        }
        return true;
    }
}

class CharField extends BaseField {
    constructor() {
        super(...arguments);
        this.type = &apos;CharField&apos;;
    }
    create() {
        super.create();
        if (!this.value) {
            this.value = &apos;&apos;;
        }
    }
    validate(value) {
        value = this.value || value;
        if (typeof value !== &apos;string&apos;) {
            return false;
        }
        return super.validate(value);
    }
}

class IntegerField extends BaseField {
    constructor() {
        super(...arguments);
        this.type = &apos;IntegerField&apos;;
    }
}

class KeyField extends IntegerField {
    constructor() {
        super(1);
        this.type = &apos;KeyField&apos;;
        this.unique = false;
        this.minValue = 1;
        this.maxLength = 11;
        this.nullable = false;
    }
}

class ForeignKeyField extends KeyField {
    constructor(rel, args) {
        super(args);

        this.type = &apos;ForeignKeyField&apos;;

        if (!rel || !global.app.Models[ rel ]) {
            throw new $$InvalidFieldConfigError(
                this.type,
                `Invalid relative model ${rel ? `${cyan(rel)} ` : &apos;&apos;}` +
                &apos;in constrained field declaration&apos;
            );
        }

        this.nesting = this.deepNesting = false;
        if (args &amp;&amp; typeof args === &apos;object&apos;) {

            if (args.hasOwnProperty(&apos;deepNesting&apos;)) {
                this.nesting = this.deepNesting = true;
            } else {
                this.nesting = args.hasOwnProperty(&apos;nesting&apos;);
            }
        }
        this.rel = rel;
        this.type = &apos;ForeignKeyField&apos;;
    }
}

class ManyToManyField extends ForeignKeyField {
    constructor(rel, args = {}) {
        super(rel, args);

        this.type = &apos;ManyToManyField&apos;;
        this.unique = false;

        this.name = args.alias || args.name;
        if (!this.name) {
            throw new $$InvalidFieldConfigError(
                this.type,
                `${cyan(`${this.type}s`)} require name to be included in ` +
                &apos;configuration and to be valid model&apos;
            );
        }

        // Setup a reference to the relationship model
        this.crossReferenceTableId = args.tableName || `${this.name}_${this.rel}_id`;
        if (!args.crossReferenceTable) {
            global.app.Model(this.crossReferenceTableId, {
                [ `${this.name}_id` ]: new KeyField(),
                [ `${this.rel}_id` ]: new KeyField()
            });
            this.crossReferenceTable = global.app.Models[
                this.crossReferenceTableId
            ];
        } else {
            this.crossReferenceTableId = args.crossReferenceTableId;
            this.crossReferenceTable = args.crossReferenceTable;
        }
    }
}

class $$InvalidFieldConfigError extends TypeError {
    constructor(type, error = &apos;&apos;) {
        $LogProvider.error(
            `Invalid Field configuration for ${magenta(type)}` +
            `${error ? `: ${error}` : &apos;&apos;}`
        );
        super();
        p.exit(1);
    }
}

export {
    CharField,
    IntegerField,
    ForeignKeyField,
    ManyToManyField
};
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
